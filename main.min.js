function getQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(t);return null!=i?decodeURIComponent(i[2]):null}function shareConfig(e,t,i,r){var n=new BodyMenuShareAppMessage;n.title=e,n.desc=t,n.link=i,n.imgUrl=r,n.success=function(e){isCanChouJiang&&goShareScene()},n.fail=function(e){},wx.onMenuShareAppMessage(n);var s=new BodyMenuShareTimeline;s.title=t,s.link=i,s.imgUrl=r,s.success=function(e){isCanChouJiang&&goShareScene()},s.fail=function(e){},wx.onMenuShareTimeline(s);var a=new BodyMenuShareQQ;a.title=e,a.desc=t,a.link=i,a.imgUrl=r,a.success=function(e){isCanChouJiang&&goShareScene()},a.fail=function(e){},wx.onMenuShareQQ(a);var h=new BodyMenuShareWeibo;h.title=e,h.desc=t,h.link=i,h.imgUrl=r,h.success=function(e){isCanChouJiang&&goShareScene()},h.fail=function(e){},wx.onMenuShareWeibo(h)}function goShareScene(){var e=new Date;e.setDate(startDay),e.setMonth(startMonth-1),e.setHours(startHour),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);var t=new Date,i=new Date;i.setDate(endDay),i.setMonth(endMonth-1),i.setHours(endHour),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),t>=e&&i>=t?SceneControl.repleaScene(new Yyy):SceneControl.repleaScene(new EndScene)}var Animation=function(e){function t(){e.call(this),this.key=0,this.timer=new egret.Timer(1e3),this.gameTime=new egret.Timer(1,0),this.i=0,this.n=0,this.j=0,this.m=!0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),r=i.prototype;return r.onAddToStage=function(){},r.setIndex=function(){this.mc.gotoAndStop(this.i)},r.startRole=function(e,t,i){var r=this,n=RES.getRes("11_json"),s=RES.getRes("11_png");return this.mcf=new egret.MovieClipDataFactory(n,s),this.mc=new egret.MovieClip(this.mcf.generateMovieClipData("11")),this.addChild(this.mc),this.mc.gotoAndPlay(e,i),this.mc.addEventListener(egret.Event.COMPLETE,function(e){r.parent.removeChild(r),console.log("播放完成")},this),this.mc.scaleX=.5,this.mc.scaleY=.5,this.mc},t}(egret.Sprite);egret.registerClass(Animation,"Animation");var AnimPool=function(e){function t(){e.call(this),this.Anim_Zu=[]}__extends(t,e);var i=(__define,t),r=i.prototype;return r.getRole=function(e,t,i,r){var n=new Animation;return n.startRole(e,t,r),n},t}(egret.Sprite);egret.registerClass(AnimPool,"AnimPool");var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function r(r){t.call(i,r,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?r(n):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var Cell=function(e){function t(){e.call(this),this.type=0,this.arrayIndex=[],this.cell=new egret.Bitmap,this.bossAdd=new egret.Bitmap,this.isSpecial=!1,this.isCreatType=0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),r=i.prototype;return r.onAddToStage=function(){this.cell.texture=RES.getRes("jewel1_png"),this.changeType(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.dispatchEventWith(GameEvents.CELL_ADD_OVER)},r.changeType=function(){this.type=1+parseInt(Math.random()*GAME_CONFIG.TYPENUM+""),this.cell.texture=RES.getRes("jewel"+this.type+"_png"),this.addChild(this.cell)},r.setArrIndex=function(e,t){this.arrayIndex=[e,t]},r.onTouchBegin=function(e){var t=e.currentTarget,i=this.getBounds(),r=t.getBounds();i.x=this.x,i.y=this.y,r.x=t.x,r.y=t.y,i.intersects(r)&&(touchCellArr=this.arrayIndex,this.dispatchEventWith(GameEvents.TOUCH_START),SoundsMgr.clickCell())},r.movePosition=function(e,t){egret.Tween.get(this).to({x:e.x,y:e.y},100),this.arrayIndex=t},r.fallDown=function(e,t){this.arrayIndex[1]+=e,egret.Tween.get(this).to({x:this.x,y:this.y+t*e},100)},r.newBorn=function(e,t,i){this.x=e*i+13,this.y=(t-1)*i,egret.Tween.get(this).to({x:this.x,y:t*i+10},100)},r.setToSpecial=function(e){this.bossAdd.texture=RES.getRes("huang"+this.type+"_png"),this.addChild(this.bossAdd),this.isSpecial=!0,this.isCreatType=e},r.resetSpecal=function(){this.isSpecial=!1},t}(egret.Sprite);egret.registerClass(Cell,"Cell");var Director=function(){function e(){this.stackLayer=[],this.gameLayer=null}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},i.initWithMain=function(e){null==this.gameLayer&&(this.gameLayer=e)},i.repleaceScene=function(e){null!=this.gameLayer&&null!=e&&(this.gameLayer.removeChildren(),this.gameLayer.addChild(e))},i.pushScene=function(e){null!=this.gameLayer&&null!=e&&(this.gameLayer.addChild(e),this.stackLayer.push(e))},i.popScene=function(){if(null!=this.gameLayer){var e=this.stackLayer.length;if(e>0){var t=this.stackLayer[e-1];t.parent==this.gameLayer&&this.gameLayer.removeChild(t)}}},i.removeScene=function(e){if(null!=this.gameLayer&&null!=e){this.gameLayer.removeChild(e);for(var t=0;t<this.stackLayer.length;t++)e==this.stackLayer[t]&&this.stackLayer.splice(t,1)}},e.instance=null,e}();egret.registerClass(Director,"Director");var EndScene=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/endScene/endSceneUI.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){this.erWeiMa.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){window.location.href=wxUrl},this)},t}(eui.Component);egret.registerClass(EndScene,"EndScene");var FaileScene=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/faileScene/faileSceneUI.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){this.erWeiMa.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){window.location.href=faileUrl},this)},t}(eui.Component);egret.registerClass(FaileScene,"FaileScene");var FirstScene=function(e){function t(){e.call(this),this.addChild(new PlayMusic),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/firstScene/firstUI.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){this.btn_play.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlayGame,this)},r.onPlayGame=function(){SceneControl.repleaScene(new startGame),this.bgLayer=new egret.Sprite,this.bgLayer.graphics.beginFill(0),this.bgLayer.graphics.drawRect(0,0,480,854),this.bgLayer.graphics.endFill(),this.addChild(this.bgLayer),this.bgLayer.alpha=.7,SceneControl.createScene(this.bgLayer),SceneControl.createScene(new GameRule)},t}(eui.Component);egret.registerClass(FirstScene,"FirstScene");var GameEvents=function(){function e(){}var t=(__define,e);t.prototype;return e.GAME_START="GAME_START",e.REMOVE_RULE="REMOVE_RULE",e.CELL_ADD_OVER="CELL_ADD_OVER",e.TOUCH_RULE_START_GAME="TOUCH_RULE_START_GAME",e.TOUCH_START="TOUCH_START",e.SUBMIT_INFO="SUBMIT_INFO",e}();egret.registerClass(GameEvents,"GameEvents");var GameVoid=function(){function e(){}var t=(__define,e);t.prototype;return e.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e}();egret.registerClass(GameVoid,"GameVoid");var Constant=function(){function e(){this.stageW=0,this.stageH=0}var t=(__define,e);t.prototype;return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e}();egret.registerClass(Constant,"Constant");var GAME_CONFIG=function(){function e(){}var t=(__define,e);t.prototype;return e.SHRED_NUM_W=8,e.SHRED_NUM_H=8,e.BG_BOX_WIDTH=390,e.TYPENUM=5,e}();egret.registerClass(GAME_CONFIG,"GAME_CONFIG");var Creat2X2Arr=function(e,t,i){for(var r=[],n=0;e>n;n++){r[n]=[];for(var s=0;t>s;s++)r[n][s]=i}return r},touchCellArr=[],_isStartGame=!1,MUSIC={isCanPlay:!0},GamePlayer={score:0},Rank=function(e){function t(){e.call(this),this.addChild(new PlayMusic),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/GameRank/rankUI.exml",this.once(egret.Event.ADDED_TO_STAGE,this.init,this)}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){this.btn_share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this.btn_again.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgain,this),this.listGoods.itemRenderer=GoodsListIRSkin},r.imgLoadHandler=function(e){var t=e.currentTarget,i=t.data,r=new egret.Bitmap(i);this.touXiang.addChild(r),r.width=this.touXiang.width,r.height=this.touXiang.height},r.init=function(){if(wxArr[1]&&(this.nameLabel.text=wxArr[1]),wxArr[2]){var e=new egret.ImageLoader;e.once(egret.Event.COMPLETE,this.imgLoadHandler,this),e.load(wxArr[2])}isFenxiang=!0,isCanChouJiang=!0},r.onGetComplete=function(e){var t=e.currentTarget;console.log("get data : ",t.response);var i=JSON.parse(t.response),r=i.score,n=i.order,s=i.data;this.listGoods.dataProvider=new eui.ArrayCollection(s),this.getScore.text=r,this.rankLabel.text=n;for(var a=0;a<s.length;a++){s[a].headimgurl}shareConfig(title,desc,link,imgUrl)},r.onShare=function(){var e=this,t=new egret.Sprite;t.graphics.beginFill(0),t.graphics.drawRect(0,0,480,854),t.graphics.endFill(),this.addChild(t),t.alpha=.3,t.touchEnabled=!0;var i=new egret.Bitmap;i.texture=RES.getRes("jiantou_png"),this.addChild(i),i.x=this.stage.stageWidth/5,i.y=i.height/2,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.removeChild(t),e.removeChild(i)},this),SceneControl.repleaScene(new Yyy)},r.onAgain=function(){isCanChouJiang=!1,shareConfig(title,desc,link,imgUrl),SceneControl.repleaScene(new startGame),this.bgLayer=new egret.Sprite,this.bgLayer.graphics.beginFill(0),this.bgLayer.graphics.drawRect(0,0,480,854),this.bgLayer.graphics.endFill(),this.addChild(this.bgLayer),this.bgLayer.alpha=.7,SceneControl.createScene(this.bgLayer),SceneControl.createScene(new GameRule)},t}(eui.Component);egret.registerClass(Rank,"Rank");var GoodsListIRSkin=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="rankListUI"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){this.addEventListener(egret.Event.ADDED_TO_STAGE,this.init,this)},r.init=function(){},t}(eui.ItemRenderer);egret.registerClass(GoodsListIRSkin,"GoodsListIRSkin");var GameRule=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/gameRule/gameRuleUI.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this)},r.onStart=function(){Director.getInstance().removeScene(this),Director.getInstance().popScene(),_isStartGame=!0},t}(eui.Component);egret.registerClass(GameRule,"GameRule");var HandleDelSameCell=function(){function e(){}var t=(__define,e);t.prototype;return e.filterDelSame=function(e,t){for(var i=e.concat(t),r=0;r<i.length;r++)for(var n=i[r],s=r+1;s<i.length;s++)i[s][0]==n[0]&&i[s][1]==n[1]&&(i.splice(s,1),s--);return i},e.filterDeleteSame=function(e,t){for(var i=e.concat(t),r=0;r<i.length;r++)for(var n=i[r],s=r+1;s<i.length;s++)i[s][0]==n[0]&&i[s][1]==n[1]&&(i.splice(s,1),i.splice(r,1),s--);return i},e.filtCreatFourHeng=function(e){for(var t=[],i=[],r=0;r<GAME_CONFIG.SHRED_NUM_W;r++){for(var n=0;n<e.length;n++)e[n][1]==r&&t.push(e[n]);t.length>0&&i.push(t),t=[]}return i},e.filtCreatFourShu=function(e){for(var t=[],i=[],r=0;r<GAME_CONFIG.SHRED_NUM_W;r++){for(var n=0;n<e.length;n++)e[n][0]==r&&t.push(e[n]);t.length>0&&i.push(t),t=[]}return i},e}();egret.registerClass(HandleDelSameCell,"HandleDelSameCell");var InputScene=function(e){function t(){e.call(this),this.yyy=new Yyy,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/inputScene/inputSceneUI.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){var e=this;this.inputPhone.maxChars=11,this.onNext.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.inputPhone.text;return 0==t.trim().length?void alert("请输入您的手机号！"):void(window.location.href=winUrl)},this)},r.onGetComplete=function(e){egret.setTimeout(function(){window.location.href=winUrl},this,1e3)},t}(eui.Component);egret.registerClass(InputScene,"InputScene");var LoadingUI=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createBitmapByName("resource/res/jindutiao.png","resource/res/wanzhengjindutiao.png","resource/res/beijing5.jpg","resource/res/baifenbi.png")}__extends(t,e);var i=(__define,t),r=i.prototype;return r.onAddToStage=function(){shareConfig(title,desc,link,imgUrl)},r.createBitmapByName=function(e,t,i,r){this.beijing=new egret.Bitmap,this.beijing.x=0,this.beijing.y=0,this.addChild(this.beijing),this.jinDuKuang=new egret.Bitmap,this.jinDuKuang.x=55,this.jinDuKuang.y=592,this.addChild(this.jinDuKuang),this.jindu=new egret.Bitmap,this.jindu.x=65,this.jindu.y=598,this.addChild(this.jindu),this.baiFenBi=new egret.Bitmap,this.baiFenBi.x=200,this.baiFenBi.y=598,this.addChild(this.baiFenBi);var n=this;this.maskRect=new egret.Rectangle(0,0,0,24),this.jindu.mask=this.maskRect,RES.getResByUrl(i,function(e){n.beijing.texture=e},this,RES.ResourceItem.TYPE_IMAGE),RES.getResByUrl(e,function(e){n.jinDuKuang.texture=e},this,RES.ResourceItem.TYPE_IMAGE),RES.getResByUrl(r,function(e){n.baiFenBi.texture=e},this,RES.ResourceItem.TYPE_IMAGE),RES.getResByUrl(t,function(e){n.jindu.texture=e},this,RES.ResourceItem.TYPE_IMAGE)},r.setProgress=function(e,t){var i=e/t;this.maskRect=new egret.Rectangle(0,0,i*this.jindu.width,24),this.jindu.mask=this.maskRect},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),r=i.prototype;return r.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},r.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},r.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},r.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},r.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&(Constant.getInstance().stageW=this.stage.stageWidth,Constant.getInstance().stageH=this.stage.stageHeight,this.startCreateScene())},r.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},r.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},r.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},r.startCreateScene=function(){SoundsMgr.playBg(),Director.getInstance().initWithMain(this);var e=new FirstScene;SceneControl.createScene(e);var t=this.createBitmapByName("beijing5_jpg"),i=this.stage.stageWidth,r=this.stage.stageHeight;t.width=i,t.height=r;var n=new egret.Shape;n.graphics.beginFill(0,.5),n.graphics.drawRect(0,0,i,172),n.graphics.endFill(),n.y=33;var s=this.createBitmapByName("egret_icon_png");s.x=26,s.y=33;var a=new egret.Shape;a.graphics.lineStyle(2,16777215),a.graphics.moveTo(0,0),a.graphics.lineTo(0,117),a.graphics.endFill(),a.x=172,a.y=61;var h=new egret.TextField;h.textColor=16777215,h.width=i-172,h.textAlign="center",h.text="Hello Egret",h.size=24,h.x=172,h.y=80;var o=new egret.TextField;o.alpha=0,o.width=i-172,o.textAlign=egret.HorizontalAlign.CENTER,o.size=24,o.textColor=16777215,o.x=172,o.y=135,this.textfield=o,RES.getResAsync("description_json",this.startAnimation,this);var l=new eui.Button;l.label="Click!",l.horizontalCenter=0,l.verticalCenter=0,l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},r.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},r.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,r=[],n=0;n<e.length;n++)r.push(i.parser(e[n]));var s=t.textfield,a=-1,h=function(){a++,a>=r.length&&(a=0);var e=r[a];t.changeDescription(s,e);var i=egret.Tween.get(s);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(h,t)};h()},r.changeDescription=function(e,t){e.textFlow=t},r.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0},t}(eui.UILayer);egret.registerClass(Main,"Main");var PlayMusic=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/music/playMusicUI.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){this.play_music.addEventListener(egret.Event.CHANGE,this.onChange,this),this.play_music.$setSelected(!MUSIC.isCanPlay)},r.onChange=function(e){this.play_music.selected?(SoundsMgr.stopBg(),MUSIC.isCanPlay=!1):(SoundsMgr.playBg(),MUSIC.isCanPlay=!0)},t}(eui.Component);egret.registerClass(PlayMusic,"PlayMusic");var SoundsMgr=function(){function e(){}var t=(__define,e);t.prototype;return e.playFourClear=function(){this.playMusic("fourClear_mp3")},e.playHengShu=function(){this.playMusic("hengshu_mp3")},e.clickCell=function(){this.playMusic("click_mp3")},e.playBg=function(){this.playMusic("bg_mp3")},e.stopBg=function(){this.stopMusic("bg_mp3")},e.clearCell=function(){this.playMusic("clear_mp3")},e.playMusic=function(e){var t=RES.getRes(e.toString());t&&("bg_mp3"==e?(this.bgSoundChannel=t.play(this.pauseTime,1),this.bgSoundChannel.addEventListener(egret.Event.SOUND_COMPLETE,this.onComplete,this)):this.bgSoundChannel=t.play(0,1))},e.onComplete=function(){this.pauseTime=0,this.playBg()},e.stopMusic=function(e){this.bgSoundChannel&&(this.pauseTime=this.bgSoundChannel.position,this.bgSoundChannel.stop())},e.bgSoundChannel=null,e.pauseTime=0,e}();egret.registerClass(SoundsMgr,"SoundsMgr");var SceneControl=function(){function e(){}var t=(__define,e);t.prototype;return e.createScene=function(e){var t=e;Director.getInstance().pushScene(t)},e.repleaScene=function(e){var t=e;Director.getInstance().repleaceScene(t)},e}();egret.registerClass(SceneControl,"SceneControl");var wxArr=[],startGame=function(e){function t(){e.call(this),this._bgwid=0,this.shred_arr=[],this._fourCellHengArr=[],this._fourCellShuArr=[],this._checkFirstFourArr=[],this._booFirstArr=[],this.cell=new Cell,this._firstSp=null,this._checkIsOver=!1,this._isTouchStart=!1,this._haveFourCell=!1,this._fourCellNum=0,this._count=0,this._bo=!0,this._isFirstClear=!0,this._isTouchSpcial=!1,this._boo=!1,this._timeCount=60,this.setScore=0,this.countTimer=new egret.Timer(1e3,0),this.addEvtCount=new egret.Timer(1,0),this.touchCellSp=new egret.Bitmap,this.anim=new Animation,this.animPool=new AnimPool,this.addChild(new PlayMusic),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/startGame/startGameUI.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.imgLoadHandler=function(e){var t=e.currentTarget,i=t.data,r=new egret.Bitmap(i);this.touXiang.addChild(r),r.width=this.touXiang.width,r.height=this.touXiang.height},r.uiCompHandler=function(){var e=this;this.countTimeLabel.text=this._timeCount+"",this.scoreLabel.text=this.setScore+"",this.countTimer.addEventListener(egret.TimerEvent.TIMER,this.oncountFrameFile,this);new GameRule;this.addEvtCount.addEventListener(egret.TimerEvent.TIMER,function(){_isStartGame&&(e.countTimer.start(),e.addEvtCount.stop())},this),this.addEvtCount.start();var t=new egret.Bitmap;t=GameVoid.createBitmapByName("gamebiankuang_png"),this.totalGroup.addChild(t),this.shred_arr=Creat2X2Arr(GAME_CONFIG.SHRED_NUM_W,GAME_CONFIG.SHRED_NUM_H,1),this._bgwid=GAME_CONFIG.BG_BOX_WIDTH/GAME_CONFIG.SHRED_NUM_W;for(var i=0;i<GAME_CONFIG.SHRED_NUM_W;i++)for(var r=0;r<GAME_CONFIG.SHRED_NUM_H;r++)this.cell=new Cell,this.totalGroup.addChild(this.cell),this.cell.x=i*this._bgwid+13,this.cell.y=r*this._bgwid+10,this.shred_arr[i][r]=this.cell,this.cell.setArrIndex(i,r),this.cell.addEventListener(GameEvents.TOUCH_START,this.onStart,this);this.totalGroup.setChildIndex(t,this.totalGroup.numChildren),this.cell.addEventListener(GameEvents.CELL_ADD_OVER,this._changeArr,this)},r._changeArr=function(){var e=this._checkArr();if(e.length>0){for(var t in e){var i=e[t];this.shred_arr[i[0]][i[1]].changeType()}this._changeArr()}else console.log("没有相连的3个相同颜色块了"),RES.removeEventListener(GameEvents.CELL_ADD_OVER,this._changeArr,this)},r._checkArr=function(){for(var e=[],t=0;t<GAME_CONFIG.SHRED_NUM_W;t++)for(var i=0;i<GAME_CONFIG.SHRED_NUM_H;i++)t<GAME_CONFIG.SHRED_NUM_W-2&&this.shred_arr[t][i].type==this.shred_arr[t+1][i].type&&this.shred_arr[t+1][i].type==this.shred_arr[t+2][i].type&&e.push([t,i],[t+1,i],[t+2,i]),i<GAME_CONFIG.SHRED_NUM_W-2&&this.shred_arr[t][i].type==this.shred_arr[t][i+1].type&&this.shred_arr[t][i+1].type==this.shred_arr[t][i+2].type&&e.push([t,i],[t,i+1],[t,i+2]),t<GAME_CONFIG.SHRED_NUM_W-3&&this._isTouchStart&&this.shred_arr[t][i].type==this.shred_arr[t+1][i].type&&this.shred_arr[t+1][i].type==this.shred_arr[t+2][i].type&&this.shred_arr[t+2][i].type==this.shred_arr[t+3][i].type&&this._fourCellHengArr.push([t,i],[t+1,i],[t+2,i],[t+3,i]),i<GAME_CONFIG.SHRED_NUM_W-3&&this._isTouchStart&&this.shred_arr[t][i].type==this.shred_arr[t][i+1].type&&this.shred_arr[t][i+1].type==this.shred_arr[t][i+2].type&&this.shred_arr[t][i+2].type==this.shred_arr[t][i+3].type&&this._fourCellShuArr.push([t,i],[t,i+1],[t,i+2],[t,i+3]);var r=[];return e=HandleDelSameCell.filterDelSame(e,r),this._fourCellShuArr=HandleDelSameCell.filterDelSame(this._fourCellShuArr,r),this._fourCellHengArr=HandleDelSameCell.filterDelSame(this._fourCellHengArr,r),e},r.onStart=function(){this._isTouchStart=!0;var e=touchCellArr;if(touchCellArr=[],console.log("当前点击块",e[0],e[1]),!this._checkIsOver)if(null==this._firstSp)this.changeAphla(e),this._firstSp=e;else{if(this._firstSp==e)return this.resetAphla(),void(this._firstSp=null);e[0]!=this._firstSp[0]&&e[1]!=this._firstSp[1]||1!=Math.abs(e[0]-this._firstSp[0]+e[1]-this._firstSp[1])?(this.resetAphla(),this._firstSp=e,this.changeAphla(e)):(this._checkIsOver=!0,this._changePos(this._firstSp,e,!0),this.resetAphla(),this._firstSp=null)}},r.changeAphla=function(e){this.touchCellSp.texture=RES.getRes("kuang_png"),this.touchCellSp.x=this.shred_arr[e[0]][e[1]].x,this.touchCellSp.y=this.shred_arr[e[0]][e[1]].y,this.totalGroup.addChild(this.touchCellSp)},r.resetAphla=function(){this.totalGroup.removeChild(this.touchCellSp)},r._changePos=function(e,t,i){var r=new egret.Bitmap,n=new egret.Bitmap,s=new egret.Bitmap;if(r=this.shred_arr[e[0]][e[1]],n=this.shred_arr[t[0]][t[1]],this.shred_arr[e[0]][e[1]].movePosition(n,t),this.shred_arr[t[0]][t[1]].movePosition(r,e),s=this.shred_arr[e[0]][e[1]],this.shred_arr[e[0]][e[1]]=this.shred_arr[t[0]][t[1]],this.shred_arr[t[0]][t[1]]=s,i){var a=this;egret.setTimeout(function(){var i=a._checkArr();0==i.length?(a._changePos(t,e,!1),a._checkIsOver=!1):(a._checkIsDown(i,t,e),console.log("可以消除"))},this,300)}},r._checkFourArr=function(e,t){var i=[];for(var r in this._fourCellShuArr){var n=this._fourCellShuArr[r];(n[0]==t[0]&&n[1]==t[1]||n[0]==e[0]&&n[1]==e[1])&&(console.log("生成消除横着一条的方块",n[0],n[1]),this.shred_arr[n[0]][n[1]].setToSpecial(1),this._fourCellNum++,i.push(n))}for(var s in this._fourCellHengArr){var a=this._fourCellHengArr[s];(a[0]==t[0]&&a[1]==t[1]||a[0]==e[0]&&a[1]==e[1])&&(console.log("生成消除竖着一条的方块",a[0],a[1]),this.shred_arr[a[0]][a[1]].setToSpecial(2),this._fourCellNum++,i.push(a))}return i},r._checkIsState=function(e){var t=[];for(var i in this._fourCellShuArr){var r=this._fourCellShuArr[i];r[0]==e[0]&&r[1]==e[1]&&(console.log("生成消除横着一条的方块",r[0],r[1]),this.shred_arr[r[0]][r[1]].setToSpecial(1),this._fourCellNum++,t.push(r))}for(var n in this._fourCellHengArr){var s=this._fourCellHengArr[n];s[0]==e[0]&&s[1]==e[1]&&(console.log("生成消除竖着一条的方块",s[0],s[1]),this.shred_arr[s[0]][s[1]].setToSpecial(2),this._fourCellNum++,t.push(s))}return t},r._checkIsDown=function(e,t,i){this._haveFourCell=!1;var r;if(this._isFirstClear){for(var n in e){var s=e[n];s[0]==t[0]&&s[1]==t[1]?r=t:s[0]==i[0]&&s[1]==i[1]&&(r=i)}if(e.length>=4&&this.shred_arr[r[0]][r[1]].isSpecial)(this._fourCellShuArr.length>0||this._fourCellHengArr.length>0)&&(this._isTouchSpcial=!0);else{for(var a in e){var h=e[a];if(h[0]==t[0]&&h[1]==t[1]&&(this._fourCellHengArr.length>0||this._fourCellShuArr.length>0)||h[0]==i[0]&&h[1]==i[1]&&(this._fourCellHengArr.length>0||this._fourCellShuArr.length>0))var o=this._checkFourArr(t,i)}o&&(e=HandleDelSameCell.filterDeleteSame(e,o),this._checkFirstFourArr.push(o))}}else{if(this._fourCellHengArr.length>0)for(var l=HandleDelSameCell.filtCreatFourHeng(this._fourCellHengArr),c=0;c<l.length;c++)for(var u=0;u<l[c].length;u++)if(!this.shred_arr[l[c][u][0]][l[c][u][1]].isSpecial){var d=this._checkIsState(l[c][u]);d&&(e=HandleDelSameCell.filterDeleteSame(e,d),this._checkFirstFourArr.push(d));break}if(this._fourCellShuArr.length>0)for(var g=HandleDelSameCell.filtCreatFourShu(this._fourCellShuArr),_=0;_<g.length;_++)for(var p=0;p<g[_].length;p++)if(!this.shred_arr[g[_][p][0]][g[_][p][1]].isSpecial){var f=this._checkIsState(g[_][p]);f&&(e=HandleDelSameCell.filterDeleteSame(e,f),this._checkFirstFourArr.push(f));break}}e=this._isCheckFourClear(e),this._isTouchSpcial&&(e=HandleDelSameCell.filterDeleteSame(e,r),this._fourCellShuArr.length>0?(this.shred_arr[r[0]][r[1]].setToSpecial(1),this._fourCellNum++):(this.shred_arr[r[0]][r[1]].setToSpecial(2),this._fourCellNum++)),this._clearCell(e)},r._isCheckFourClear=function(e){this._boo=!1,this._bo=!1;var t=[];for(var i in e){var r=e[i];if(this._checkFirstFourArr.length>0)for(var n in this._checkFirstFourArr){var s=this._checkFirstFourArr[n];r[0]==s[0][0]&&r[1]==s[0][1]&&(this._boo=!0,this._booFirstArr.push(r))}}this._boo&&(e=HandleDelSameCell.filterDeleteSame(e,this._booFirstArr),this._booFirstArr=[]);for(var a in e){var h=e[a];if(this.shred_arr[h[0]][h[1]].isSpecial)if(this._bo=!0,this.shred_arr[h[0]][h[1]].resetSpecal(),1==this.shred_arr[h[0]][h[1]].isCreatType){this._haveFourCell=!0;for(var o=0;o<GAME_CONFIG.SHRED_NUM_W;o++)t.push([o,h[1]])}else{this._haveFourCell=!0;for(var l=0;l<GAME_CONFIG.SHRED_NUM_W;l++)t.push([h[0],l])}}return t&&(e=HandleDelSameCell.filterDelSame(t,e)),this._bo?this._isCheckFourClear(e):this._returnClearArr=e.slice(),this._returnClearArr},r._clearCell=function(e){this._haveFourCell?SoundsMgr.playHengShu():this._fourCellShuArr.length>0||this._fourCellHengArr.length>0?SoundsMgr.playFourClear():SoundsMgr.clearCell();for(var t in e){var i=e[t];this.anim=this.animPool.getRole(1,6,100,1),this.anim.x=this.shred_arr[i[0]][i[1]].x+25,this.anim.y=this.shred_arr[i[0]][i[1]].y+29,this.totalGroup.addChild(this.anim),this.totalGroup.removeChild(this.shred_arr[i[0]][i[1]]),this.shred_arr[i[0]][i[1]]=null}this._count+=1,this.setScore+=(e.length+this._fourCellNum)*this._count*10,this.scoreLabel.text=this.setScore+"",this._fourCellNum=0,this._fourCellShuArr=[],this._fourCellHengArr=[],this._isFirstClear=!1,this._returnClearArr=[],this._isTouchSpcial=!1,this._checkFirstFourArr=[];var r=this;egret.setTimeout(function(){r._shredDown()},this,100)},r._shredDown=function(){for(var e=0;e<GAME_CONFIG.SHRED_NUM_W;e++)for(var t=GAME_CONFIG.SHRED_NUM_H-1;t>=0;t--){var i=0;if(null!=this.shred_arr[e][t]){for(var r=t;r<GAME_CONFIG.SHRED_NUM_H;r++)null==this.shred_arr[e][r]&&i++;if(0!=i){this.shred_arr[e][t].fallDown(i,this._bgwid);var n=this.shred_arr[e][t].arrayIndex;this.shred_arr[n[0]][n[1]]=this.shred_arr[e][t],this.shred_arr[e][t]=null}}}var s=this;egret.setTimeout(function(){s._fillEmpty()},this,100)},r._fillEmpty=function(){for(var e=this,t=0;t<GAME_CONFIG.SHRED_NUM_W;t++)for(var i=0;i<GAME_CONFIG.SHRED_NUM_H;i++)if(null==this.shred_arr[t][i]){var r=new Cell;this.totalGroup.addChild(r),this.shred_arr[t][i]=r,r.newBorn(t,i,this._bgwid),r.setArrIndex(t,i),r.addEventListener(GameEvents.TOUCH_START,this.onStart,this)}console.log("补缺完成");var n=this._checkArr();if(0==n.length)console.log("进入稳定状态 停止"),this._checkIsOver=!1,this._isTouchStart=!1,this._isFirstClear=!0,this._count=0;else{var s=[],a=[];egret.setTimeout(function(){e._checkIsDown(n,s,a)},this,500)}},r.oncountFrameFile=function(){if(this._timeCount--,this._timeCount<=0){this._timeCount=0,this.countTimer.stop(),_isStartGame=!1,this._checkIsOver=!0;GamePlayer.score=this.setScore,egret.setTimeout(function(){var e=new Rank;SceneControl.createScene(e)},this,1e3)}this.countTimeLabel.text=this._timeCount+""},t}(eui.Component);egret.registerClass(startGame,"startGame");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,r){function n(e){t.call(r,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(r))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var WinScene=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/winScene/winSceneUI.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){var e=this;this.onAwards.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){console.log("点到了"),e.dispatchEventWith(GameEvents.SUBMIT_INFO),SceneControl.repleaScene(new InputScene)},this)},t}(eui.Component);egret.registerClass(WinScene,"WinScene");var title="王牌消消乐",desc="为了领张电影票  我居然把这游戏玩完了！",link="http://www.gamedo.net/movie/JJ/",imgUrl="http://www.gamedo.net/movie/JJ/resource/res/icon.jpg",startMonth=9,startDay=25,startHour=12,endDay=30,endMonth=10,endHour=12,isCanChouJiang=!1,isFenxiang=!1,wxUrl="http://url.cn/2CxiseP",faileUrl="http://mp.weixin.qq.com/s?__biz=MzA5NzU1MDU1Ng==&mid=502767698&idx=1&sn=c6cf0a93a64d05ca24d84a7cd359af0e",winUrl="http://mp.weixin.qq.com/s?__biz=MzA5NzU1MDU1Ng==&mid=502767700&idx=1&sn=5b2d4ae20ce745e0836609c4eb82e8e6";window.onload=function(){var e="http://www.gamedo.net:8889/get_sign?game_url="+encodeURIComponent(location.href).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+"),t=new egret.URLLoader,i=new egret.URLRequest(e);t.load(i),i.method=egret.URLRequestMethod.GET,t.addEventListener(egret.Event.COMPLETE,function(e){var t=JSON.parse(e.target.data),i=new BodyConfig;i.debug=!1,i.appId="wx8923c424f092e0af",i.timestamp=t.timestamp,i.nonceStr=t.nonceStr,i.signature=t.signature,i.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"],wx.config(i),wx.ready(function(){shareConfig(title,desc,link,imgUrl)
})},this)};var Yyy=function(e){function t(){e.call(this),this.isWin=!1,this.isNoWin=!1,this.isDaJiang=!1,this.isMengNiu=!1,this.isShanDian=!1,this.isMigu=!1,this.isJieLuoFu=!1,this.gameWin=new WinScene,this.rewards=0,this.totalTime=0,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="src/yaoyiyao/yyy.exml"}__extends(t,e);var i=(__define,t),r=i.prototype;return r.uiCompHandler=function(){isCanChouJiang=!1,this.gameWin.addEventListener(GameEvents.SUBMIT_INFO,function(){SceneControl.repleaScene(new InputScene)},this),this.win()},r.onGetComplete=function(e){var t=e.currentTarget;console.log("get data : ",t.response);var i=JSON.parse(t.response),r=i.result;this.verification=i.verification,0==r?this.isNoWin=!0:1==r?(this.isWin=!0,this.rewards=1):2==r?(this.isDaJiang=!0,this.rewards=2):3==r?(this.isMengNiu=!0,this.rewards=2):4==r?(this.isShanDian=!0,this.rewards=2):5==r&&(this.isMigu=!0,this.rewards=2),this._motion=new egret.Motion,this._motion.addEventListener(egret.Event.CHANGE,this.onMotion,this),this._motion.start(),this.bgLayer=new egret.Sprite,this.bgLayer.graphics.beginFill(0),this.bgLayer.graphics.drawRect(0,0,480,854),this.bgLayer.graphics.endFill(),this.addChild(this.bgLayer),this.bgLayer.alpha=0},r.onMotion=function(e){var t=e.acceleration.x,i=e.acceleration.y,r=e.acceleration.z,n=Math.abs(t+i+r-this.prevX-this.prevY-this.prevZ);n>.5&&(this.totalTime+=.2),this.totalTime>10&&this._playResult(),this.prevX=t,this.prevY=i,this.prevZ=r},r._playResult=function(){this.isNoWin?this.fail():this.win()},r.fail=function(){var e=new FaileScene;this.addChild(e)},r.win=function(){this.addChild(this.gameWin)},t}(eui.Component);egret.registerClass(Yyy,"Yyy");